# Telegram Bot with Kafka Integration

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é Telegram –±–æ—Ç–∞ —Å Apache Kafka –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π –∏ —Å–æ–æ–±—â–µ–Ω–∏–π.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ tgbot/          # Telegram –±–æ—Ç —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ kafka/          # Kafka —Å–µ—Ä–≤–µ—Ä –≤ Docker
‚îî‚îÄ‚îÄ kafka-test/     # –¢–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Kafka
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### ü§ñ Telegram Bot (`tgbot/`)

–ë–æ—Ç –Ω–∞ Go —Å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å PostgreSQL.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `/start`
- –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Goose
- Graceful shutdown

[–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Üí](tgbot/TGBOT.md)

### üì® Kafka Server (`kafka/`)

Kafka –±—Ä–æ–∫–µ—Ä –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º KRaft —Ä–µ–∂–∏–º–∞ (–±–µ–∑ Zookeeper).

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Bitnami Kafka 4.0.0
- KRaft —Ä–µ–∂–∏–º (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- –ì–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –±–æ—Ç–æ–º

[–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Üí](kafka/KAFKA.md)

### üß™ Kafka Test App (`kafka-test/`)

–ü—Ä–æ—Å—Ç–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Producer/Consumer —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- Producer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
- Consumer —á–∏—Ç–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —Ç–æ–ø–∏–∫–∞
- –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –±–∞–∑–æ–≤—É—é —Ä–∞–±–æ—Ç—É —Å Kafka

[–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Üí](kafka-test/KAFKA-TEST.md)

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å Kafka

```bash
cd kafka
docker-compose up -d
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram –±–æ—Ç–∞

```bash
cd tgbot
cp .env.example .env
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å TG_TOKEN –∏ POSTGRES_DSN –≤ .env
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
cd tgbot
go run cmd/goose/main.go
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

```bash
cd tgbot
go run cmd/tgbot/main.go
```

### 5. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Kafka

```bash
cd kafka-test
go run main.go
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Docker** - –¥–ª—è Kafka
- **Go 1.21+** - –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- **PostgreSQL** - –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞
- **Telegram Bot Token** - –ø–æ–ª—É—á–∏—Ç—å —É [@BotFather](https://t.me/BotFather)

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram Bot   ‚îÇ
‚îÇ   (tgbot/)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ PostgreSQL (users)
         ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Kafka (events) [–≥–æ—Ç–æ–≤–æ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏]
                           ‚îÇ
                           ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  kafka-test  ‚îÇ
                    ‚îÇ  (producer/  ‚îÇ
                    ‚îÇ   consumer)  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Kafka Producer –≤ –±–æ—Ç–∞ –¥–ª—è —Å–æ–±—ã—Ç–∏–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å Consumer –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ Kafka
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### Kafka

```bash
# –°–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤
docker exec -it kafka kafka-topics.sh --list --bootstrap-server localhost:9092

# –°–æ–∑–¥–∞—Ç—å —Ç–æ–ø–∏–∫
docker exec -it kafka kafka-topics.sh --create \
  --bootstrap-server localhost:9092 \
  --topic bot-events \
  --partitions 3 \
  --replication-factor 1
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
go run cmd/goose/main.go

# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
goose -dir migrations postgres "$POSTGRES_DSN" down
```

## –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
Ctrl+C

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Kafka
cd kafka && docker-compose down

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å kafka-test
Ctrl+C
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT